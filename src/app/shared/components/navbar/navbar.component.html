<nav class="navbar" [class.scrolled]="scrolled">
  <div class="navbar-container">
    <!-- Logo -->
    <a routerLink="/" class="navbar-brand" (click)="closeMobileMenu()">
      <img src="assets/images/logo.png" alt="MaNi Maquinarias" class="logo" />
    </a>

    <!-- Menú Desktop -->
    <ul class="desktop-menu">
      <li
        *ngFor="let item of menuItems"
        [class.active]="isActive(item.path || '')"
      >
        <a
          (click)="item.type === 'fragment' && navigate(item)"
          [routerLink]="item.path"
          routerLinkActive="active"
          [routerLinkActiveOptions]="{ exact: true }"
        >
          <i [class]="item.icon"></i>
          <span>{{ item.title }}</span>
          <div class="hover-indicator"></div>
        </a>
      </li>
    </ul>

    <!-- Acciones -->
    <div class="navbar-actions">
      <div class="auth-buttons" *ngIf="!isAuthenticated()">
        <a routerLink="/ingresar" class="auth-button login-button">
          <i class="fas fa-sign-in-alt"></i>
          <span>Iniciar sesión</span>
        </a>

        <a routerLink="/registrar" class="auth-button register-button">
          <i class="fas fa-user-plus"></i>
          <span>Registrarse</span>
        </a>
      </div>

      <!--Profile icon -->
      <div class="profile-icon" *ngIf="isAuthenticated()">
        <a (click)="toggleDropdown()" aria-label="Perfil" tabindex="0">
          <i class="fas fa-user-circle fa-lg"></i>
        </a>

        <!-- Dropdown de usuario -->
        <ul class="dropdown-menu" *ngIf="dropdownOpen">
          <li>
            <a routerLink="/perfil"><i class="fas fa-user"></i> Mi perfil</a>
          </li>
          <li>
            <a routerLink="/gestiones"
              ><i class="fa-solid fa-gear"></i> Gestiones</a
            >
          </li>
          <li>
            <a (click)="openLogoutModal()"
              ><i class="fas fa-sign-out-alt"></i> Cerrar sesión</a
            >
          </li>
        </ul>
      </div>

      <button
        class="menu-toggle"
        (click)="toggleMobileMenu()"
        aria-label="Menú"
        [attr.aria-expanded]="mobileMenuOpen"
      >
        <span class="hamburger" [class.active]="mobileMenuOpen"></span>
      </button>
    </div>
  </div>

  <!-- Menú Mobile -->
  <div class="mobile-menu" [class.active]="mobileMenuOpen">
    <div class="mobile-menu-container">
      <button
        class="mobile-close"
        (click)="closeMobileMenu()"
        aria-label="Cerrar menú"
      >
        <i class="fas fa-times"></i>
      </button>

      <ul>
        <li *ngFor="let item of menuItems" (click)="closeMobileMenu()">
          <a [routerLink]="item.path" routerLinkActive="active">
            <i [class]="item.icon"></i>
            {{ item.title }}
          </a>
        </li>
      </ul>

      <div class="mobile-auth-buttons">
        <a
          routerLink="/ingresar"
          class="auth-button login-button"
          (click)="closeMobileMenu()"
        >
          <i class="fas fa-sign-in-alt"></i>
          Iniciar sesión
        </a>

        <a
          routerLink="/registrar"
          class="auth-button register-button"
          (click)="closeMobileMenu()"
        >
          <i class="fas fa-user-plus"></i>
          Registrarse
        </a>
      </div>
    </div>
  </div>
</nav>

<!-- Modal de cierre de sesión -->
<div class="modal-overlay" *ngIf="showLogoutModal">
  <div class="modal">
    <p>¿Estás seguro de que deseas cerrar sesión?</p>
    <div class="modal-actions">
      <button class="btn cancel" (click)="cancelLogout()">Cancelar</button>
      <button class="btn confirm" (click)="confirmLogout()">Confirmar</button>
    </div>
  </div>
</div>
